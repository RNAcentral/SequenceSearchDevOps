---
  # This role is related to producer installation
  - import_tasks: install_deps.yml
    tags: [producer-install-deps]

  - import_tasks: rsync.yml
    tags: [producer-rsync]

  - name: Install requirements
    shell: /usr/local/bin/pip install -r requirements.txt
    args:
      chdir: /srv/producer

  - import_tasks: logs.yml
    tags: [producer-logs]

  - import_tasks: build_frontend.yml
    tags: [producer-frontend]

  - name: Apply migrations to the database
    shell:
      chdir: /srv/producer
      cmd: ENVIRONMENT=PRODUCTION python36 -m producer.models

#  - name: Install lvm2
#    yum:
#      name: lvm2
#      state: latest
#
#  - name: Add Docker repo
#    get_url:
#      url: https://download.docker.com/linux/centos/docker-ce.repo
#      dest: /etc/yum.repos.d/docer-ce.repo
#    become: yes
#
#  - name: Enable Docker Edge repo
#    ini_file:
#      dest: /etc/yum.repos.d/docer-ce.repo
#      section: 'docker-ce-edge'
#      option: enabled
#      value: 0
#    become: yes
#
#  - name: Enable Docker Test repo
#    ini_file:
#      dest: /etc/yum.repos.d/docer-ce.repo
#      section: 'docker-ce-test'
#      option: enabled
#      value: 0
#    become: yes
#
#  - name: Install Docker
#    package:
#      name: docker-ce
#      state: latest
#    become: yes
#
#  - name: Start Docker service
#    service:
#      name: docker
#      state: started
#      enabled: yes
#    become: yes
#
#  - name: Add user vagrant to docker group
#    user:
#      name: vagrant
#      groups: docker
#      append: yes
#    become: yes
